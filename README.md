# Instagram API

This Rails 8 API backs the Vue client in `instagram-frontend`. It handles
authentication, posts, comments, likes, shares, direct messages, and now
notification delivery for new messages.

## Notifications domain

- `app/models/notification.rb` stores message notification metadata (preview
  text, read timestamps, relationships to users/messages).
- `app/controllers/notifications_controller.rb` exposes the JSON API used by the
  client to list notifications, mark them read one-by-one, or clear an entire
  thread.
- `config/routes.rb` now includes `resources :notifications` plus a
  compatibility route `POST /messages/mark_read` which points to
  `NotificationsController#mark_thread` so the existing frontend can keep using
  its current endpoint.
- `Message` creates the corresponding `Notification` record after every commit,
  ensuring the receiver always has a notification row that can be cleared later.

### Database changes

Run `bundle exec rails db:migrate` to create the `notifications` table. The
table schema is:

| column     | type      | notes                                      |
|------------|-----------|--------------------------------------------|
| id         | bigint PK | autogenerated                              |
| user_id    | bigint FK | recipient of the notification               |
| message_id | bigint FK | references the triggering `messages` row    |
| preview    | string    | cached preview text, defaults to empty      |
| read_at    | datetime  | `NULL` while unread, timestamp when cleared |
| timestamps | datetime  | standard Rails created/updated columns      |

Indexes:

- unique index on `message_id` to avoid duplicate notifications
- index on `read_at` plus a composite `(user_id, read_at)` for fast unread
  lookups

Test database: `bundle exec rails db:test:prepare`
